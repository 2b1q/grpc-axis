import { Module } from '@nestjs/common';
import { MongooseModule } from '@nestjs/mongoose';
import { RedisModule } from 'nestjs-redis';

import { VehicleExploitationService } from './vehicle-exploitation.service';
import { VehicleExploitationController } from './vehicle-exploitation.controller';

import { SnapshotSchema } from './schemas/snapshot.schema';
import { VehicleSchema } from './schemas/vehicle.schema';

import { TokenStore } from 'src/shared/token.store';
import { AuthGuard } from 'src/shared/auth.guard';

const REDIS_HOST = process.env.REDIS_HOST
  ? process.env.REDIS_HOST
  : 'localhost';
const REDIS_PORT = process.env.REDIS_PORT ? process.env.REDIS_PORT : 6379;

@Module({
  imports: [
    MongooseModule.forFeature([
      { name: 'Snapshot', schema: SnapshotSchema }, // register SnapshotSchema as Snapshot model at this module
      { name: 'Vehicle', schema: VehicleSchema }, // ...
    ]),
    RedisModule.register({
      url: `redis://${REDIS_HOST}:${REDIS_PORT}`,
    }),
  ],
  providers: [VehicleExploitationService, TokenStore, AuthGuard],
  controllers: [VehicleExploitationController],
})
export class VehicleExploitationModule {}
